syntax = "proto3";

package xai_api;

import "xai/api/v1/deferred.proto";
import "xai/api/v1/image.proto";
import "xai/api/v1/usage.proto";

// Aspect ratio for video generation.
enum VideoAspectRatio {
  // Invalid/unspecified aspect ratio - defaults to 16:9.
  VIDEO_ASPECT_RATIO_UNSPECIFIED = 0;

  // 1:1 aspect ratio (square).
  VIDEO_ASPECT_RATIO_1_1 = 1;

  // 16:9 aspect ratio (wide landscape).
  VIDEO_ASPECT_RATIO_16_9 = 2;

  // 9:16 aspect ratio (tall portrait).
  VIDEO_ASPECT_RATIO_9_16 = 3;

  // 4:3 aspect ratio (standard landscape).
  VIDEO_ASPECT_RATIO_4_3 = 4;

  // 3:4 aspect ratio (standard portrait).
  VIDEO_ASPECT_RATIO_3_4 = 5;

  // 3:2 aspect ratio (photo landscape).
  VIDEO_ASPECT_RATIO_3_2 = 6;

  // 2:3 aspect ratio (photo portrait).
  VIDEO_ASPECT_RATIO_2_3 = 7;
}

// Resolution for video generation.
enum VideoResolution {
  // Invalid/unspecified resolution - defaults to 480p.
  VIDEO_RESOLUTION_UNSPECIFIED = 0;

  // 480p resolution.
  // Dimensions vary by aspect ratio
  VIDEO_RESOLUTION_480P = 1;

  // 720p resolution.
  // Dimensions vary by aspect ratio
  VIDEO_RESOLUTION_720P = 2;
}

// Specifies a video by URL for video editing.
message VideoUrlContent {
  // Either a URL of the video (e.g., a public URL) or a base64-encoded video
  // as a data URL (e.g., "data:video/mp4;base64,...").
  string url = 1;
}

// An API service for interaction with video generation models.
service Video {
  // Create a video based on a text prompt and optionally an image.
  // If an image is provided, generates video with the image as the first frame (image-to-video).
  // If no image is provided, generates video from text only (text-to-video).
  //
  // This is an asynchronous operation. The method returns immediately with a request_id
  // that can be used to poll for the result using GetDeferredVideo.
  rpc GenerateVideo(GenerateVideoRequest) returns (StartDeferredResponse) {}

  // Gets the result of a video generation started by calling `GenerateVideo`.
  rpc GetDeferredVideo(GetDeferredVideoRequest) returns (GetDeferredVideoResponse) {}
}

// Output destination for generated video.
message VideoOutput {
  // Signed URL to upload the generated video via HTTP PUT.
  string upload_url = 1;
}

// Request message for generating a video.
message GenerateVideoRequest {
  // Input prompt to generate a video from.
  string prompt = 1;

  // Optional input image for image-to-video generation.
  // If provided, generates video with this image as the first frame.
  // If omitted, generates text-to-video.
  // Supports the same formats as image generation: URL or base64-encoded image.
  ImageUrlContent image = 2;

  // Name or alias of the video generation model to be used.
  string model = 3;

  // Duration of the video to be generated in seconds (1-15 seconds).
  optional int32 duration = 4;

  // Optional input video for video editing.
  // If provided, the video will be edited based on the prompt.
  // Supports URL or base64-encoded video data.
  VideoUrlContent video = 6;

  // Optional aspect ratio for video generation.
  // Defaults to 16:9 if not specified.
  optional VideoAspectRatio aspect_ratio = 7;

  // Optional resolution for video generation.
  // Defaults to 480p if not specified.
  optional VideoResolution resolution = 8;
}

// Request for retrieving deferred video generation results.
message GetDeferredVideoRequest {
  // The ID of the request to get.
  string request_id = 1;
}

// The response from the video generation models containing the generated video.
message VideoResponse {
  // The generated video.
  GeneratedVideo video = 1;

  // The model used to generate the video (ignoring aliases).
  string model = 2;

  // The usage of the request.
  SamplingUsage usage = 3;
}

// Contains all data related to a generated video.
message GeneratedVideo {
  // A url that points to the generated video.
  string url = 1;

  // Duration of the generated video in seconds.
  int32 duration = 4;

  // Whether the video generated by the model respects moderation rules.
  // The field will be true if the video respects moderation rules. Otherwise
  // the field will be false and the video url field will be empty.
  bool respect_moderation = 5;
}

// Response from GetDeferredVideo, including the response if the video
// generation request has been processed without error.
message GetDeferredVideoResponse {
  // Current status of the request.
  DeferredStatus status = 1;

  // Response. Only present if `status=DONE`
  optional VideoResponse response = 2;
}
